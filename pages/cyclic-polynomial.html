

<div id="cyclic-polynimial" class="model">
    <h5 class="modelTitle" id="modelTitle">Interactive Simulation Model of Cyclic Code - Polynomial Algorithm</h5>
    <div id="scroll-container">
        <div class="cp" id="cp" >
            <span class="menuItem">
                <label for="infoBitNum">m =</label>
                <select id="infoBitNum" name="InfoBits" title="Info Bits Number">
                  <option value=4 >4</option>
                  <option value=5 >5</option>
                  <option value=6 >6</option>
                  <option value=7 >7</option>
                  <option value=8 >8</option>
                  <option value=9 >9</option>
                  <option value=10 selected>10</option>
                  <option value=11 >11</option>
                  <option value=12 >12</option>
                  <option value=13 >13</option>
                  <option value=14 >14</option>
                  <option value=15 >15</option>
                  <option value=16 >16</option>
                  <option value=17 >17</option>
                  <option value=18 >18</option>
                  <option value=19 >19</option>
                  <option value=20 >20</option>
                  <option value=21 >21</option>
                  <option value=22 >22</option>
                  <option value=23 >23</option>
                  <option value=24 >24</option>
                  <option value=25 >25</option>
                  <option value=26 >26</option>
                </select>
            </span>
            <span class="menuItem">
                <label for="errDetectNum">l =</label>
                <select id="errDetectNum" name="errDetectNum" onchange="setGenPolyList()">
                    <option value=2 selected>2</option>
                    <option value=3 >3</option>
                </select>
            </span>

            <span class="menuItem">
                2<sup>k</sup> - k &ge; m+1  =>
            </span>

            <span class="menuItem">
                <label for="parityBitNum">k =</label>
                <select id="parityBitNum" name="parityBitNum">
                  <option value=0 ></option>
                  <option value=3 >3</option>
                  <option value=4 selected>4</option>
                  <option value=5 >5</option>
                  <option value=6 >6</option>
                </select>
            </span>

            <span  class="menuItem">
                <label for="cwBitNum">n =</label>
                <select id="cwBitNum" name="codewordBitNum" onchange="calcSize()">
                  <option value=0 ></option>
                  <option value=7 >7</option>
                  <option value=8 >8</option>
                  <option value=9 >9</option>
                  <option value=10 >10</option>
                  <option value=11 >11</option>
                  <option value=12 >12</option>
                  <option value=13 >13</option>
                  <option value=14 selected>14</option>
                  <option value=15 >15</option>
                  <option value=16 >16</option>
                  <option value=17 >17</option>
                  <option value=18 >18</option>
                  <option value=19 >19</option>
                  <option value=20 >20</option>
                  <option value=21 >21</option>
                  <option value=22 >22</option>
                  <option value=23 >23</option>
                  <option value=24 >24</option>
                  <option value=25 >25</option>
                  <option value=26 >26</option>
                  <option value=27 >27</option>
                  <option value=28 >28</option>
                  <option value=29 >29</option>
                  <option value=30 >30</option>
                  <option value=31 >31</option>
                  <option value=32 >32</option>
                </select>
            </span>
            <span  class="menuItem">
                <label for="genPoly" >P(X) = </label>
                <select id="genPoly" name="genPoly"></select>
            </span>
            <span  class="menuItem">
                <button type="button" id="checkBtn" onclick="ckeckParam()">Open the Model</button>
            </span>
            <span  class="menuItem"  id="nextBtnSpan"></span>
            <span  class="menuItem" id="autoRunBtnSpan"></span>
            <span  class="menuItem">
                <button type="button" id="resetBtn" onclick="model.reset()" disabled>Reset the Model</button>
            </span>
        </div>
        <div id="konvaContainer"> </div>
    </div>
</div>
<!--------------------------SCRIPT-------------------------------------->
<script type="text/javascript">

    $(function() {
        // $('#scroll-container').height(($( window ).height() - $('#scroll-container').position().top));
        // $('.model').height(($( window ).height() - $('.model').position().top));
        // $('#scroll-container').width($( window ).width() - $('#scroll-container').position().left -22);

        setGenPolyList(); // load genpoly list

        $('#modelTitle').html(lang.gn.cyclicPolyModelTitle);
        $('#checkBtn').html(lang.gn.openMdlBtn);
        $('#resetBtn').html(lang.gn.resetMdlBtn);
        $('label[for=encRadio]').html(lang.gn.encRadio);
        $('label[for=decRadio]').html(lang.gn.decRadio);
        $('#mode').html(lang.gn.mode);

        $('#infoBitNum').prop('title', lang.gn.mTitle);
        $('#errDetectNum').prop('title', lang.gn.lTitle);
        $('#parityBitNum').prop('title', lang.gn.kTitle);
        $('#cwBitNum').prop('title', lang.gn.nTitle);
        $('#genPoly').prop('title', lang.gn.genPoly);

        if(userName === 'yaliev' || userName === 'earsova' || userName === 'givanova'){
            let $nextBtn = $('<input type="button" id="nextBtn" onclick="model.runCurrStep()" value ="Run Step"  disabled />');
            let $autoRunBtnBtn = $('<input type="button" id="autoRunBtn" onclick="model.autoRun()" value ="Autorun" disabled />');
            $nextBtn.appendTo($("#nextBtnSpan"));
            $autoRunBtnBtn.appendTo($("#autoRunBtnSpan"));
        }
    });

    var componentsPos={ir:'', cr:'', en:'', dec:'', alg:''};

    // creating the Stage
    var stage = new Konva.Stage({
        container: 'konvaContainer',
        width: $('.model').width(),
        height: $('.model').height(),
        cursor: 'default',
        draggable: false
    });

    // creating the model object
    var model = new ccPolyModel();

    $('.model').height(model.height);

    // error for code parameters
    let errors = {count:0, history:[]};

    //check for correct code parameters
    function ckeckParam(){
        let codeParam ={
            m: Number(document.getElementById('infoBitNum').value),
            k: Number(document.getElementById('parityBitNum').value),
            n: Number(document.getElementById('cwBitNum').value),
            t: Number(document.getElementById('errDetectNum').value),
            genPoly: {val: $('#genPoly option:selected').val(), txt: $('#genPoly option:selected').text()},
            lang: currlang
        };
        let check = model.checkParam(codeParam);
        if (check === true){ // if parameters is right run the below

            let layers = model.init(errors);
            layers.forEach(layer => {
                stage.add(layer);
            });
            model.stat.userName = userName;

            $( "#checkBtn" ).prop( "disabled", true );
            $( "#infoBitNum" ).prop( "disabled", true );
            $( "#parityBitNum" ).prop( "disabled", true );
            $( "#cwBitNum" ).prop( "disabled", true );
            $( "#errDetectNum" ).prop( "disabled", true );
            $( "#genPoly" ).prop( "disabled", true );
            $( "#nextBtn" ).prop( "disabled", true );
            $( "#resetBtn" ).prop( "disabled", true );
            $( "#autoRunBtn" ).prop( "disabled", true );
        }
        else{
            errors.count++;
            errors.history.unshift(check);
            $("#msgDialog").dialog('option','title', lang.gn.error);
            $("#msgDialog").css({'color':'red'});
            $("#msgDialog").html(check+' !');
            $("#msgDialog").dialog({show : 'shake'});
            $("#msgDialog").dialog('open');
        }
    }

    document.addEventListener('DOMContentLoaded', function(){
        // changeDivSize();
        langChange();
        document.getElementById('checkBtn').disabled=false;
        document.getElementById('infoBitNum').disabled=false;
        document.getElementById('parityBitNum').disabled=false;
        document.getElementById('cwBitNum').disabled=false;
        document.getElementById('errDetectNum').disabled=false;
        document.getElementById('nextBtn').disabled=true;
        document.getElementById('resetBtn').disabled=true;
        document.getElementById('autoRunBtn').disabled=true;
    }, false);

    // generating the generator polynomials
    function setGenPolyList(){
        let selectedT = Number(document.getElementById('errDetectNum').value);
        let optionsT2 = [];
        optionsT2.push({value:'3.1',text:'X^3 + X + 1'});
        optionsT2.push({value:'3.2',text:'X^3 + X^2 + 1'});
        optionsT2.push({value:'4.1',text:'X^4 + X + 1'});
        optionsT2.push({value:'4.2',text:'X^4 + X^3 + 1'});
        optionsT2.push({value:'5.1',text:'X^5 + X^2 + 1'});
        optionsT2.push({value:'5.2',text:'X^5 + X^3 + 1'});
        let optionsT3 = [];
        optionsT3.push({value:'3.3',text:'X^4 + X^3 + X^2 + 1'});
        optionsT3.push({value:'3.4',text:'X^4 + X^2 + 1'});
        optionsT3.push({value:'4.3',text:'X^5 + X^4 + X^2 + 1'});
        optionsT3.push({value:'4.4',text:'X^5 + X^3 + X + 1'});
        optionsT3.push({value:'5.3',text:'X^6 + X^5 + X^3 + X^2 + X + 1'});
        optionsT3.push({value:'5.4',text:'X^6 + X^5 + X^4 + X^3 + X + 1'});
        let selectMenu = document.getElementById('genPoly');
        selectMenu.options.length=0;
        if (selectedT == 2){
            for (let i=0; i<optionsT2.length; i++){
                let options = document.createElement('option');
                options.value = optionsT2[i].value;
                options.text  = optionsT2[i].text;
                if (i == 2) options.defaultSelected= true;
                selectMenu.add(options,options[i]);
            }
        }
        else if(selectedT == 3){
            for (let i=0; i<optionsT3.length; i++){
                let options = document.createElement('option');
                options.value = optionsT3[i].value;
                options.text  = optionsT3[i].text;
                //console.log(options);
                if (i == 2) options.defaultSelected= true;
                selectMenu.add(options,options[i]);
            }
        }
    }
</script>